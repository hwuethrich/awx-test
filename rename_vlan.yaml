!
! Rename VLAN '{{ input.old }}' -> '{{ input.new }}'
!
{% set dovlan=false %}
!
{% if host.facts.get('vtp') and host.facts.vtp.get('mode') and (host.facts.vtp.mode == 'Primary' or host.facts.vtp.mode == 'Transparent') %}
{% set dovlan = true %}
!
! VLAN Config, Device is in VTP Transparent or Primary mode
!
{% else %}
!
! No VLAN Config, Device is in VTP Client Mode or has no VTP at all
!
{% endif %}
!
{% if dovlan is sameas true %}
{% for vlan in host.facts.vlans %}
{% if vlan.name | regex_search('^(' ~ input.old ~ ')[^\w]+.*$|^(' ~ input.old ~ ')$', ignorecase=True) %}
vlan {{ vlan.vlan_id }}
  ! old: {{ vlan.name }}
  name {{ vlan.name | regex_replace('^(' ~ input.old ~ ')$', input.new | upper, ignorecase=True) | regex_replace('^' ~ input.old ~ '([^\w]+.*)$', input.new | upper ~ '\\1', ignorecase=True)}}

{% else %}
! IGNORED VLAN
! vlan {{ vlan.vlan_id }}
!   name {{ vlan.name }}
{% endif %}
{% endfor %}
{% endif %}
